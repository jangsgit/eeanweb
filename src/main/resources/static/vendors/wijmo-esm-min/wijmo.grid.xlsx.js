/*!
    *
    * Wijmo Library 5.20221.842
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}();import{_getModule,Control,Globalize,DataType,asBoolean,isString,isNumber,isInt,isDate,isFunction,isNullOrWhiteSpace,isObject,asEnum,getType,copy,_deprecated,_registerModule}from"wijmo/wijmo";import{FlexGrid,Row,GroupRow,Column,CellRange,CellRangeEventArgs,RowColFlags,CellType,_NewRowTemplate}from"wijmo/wijmo.grid";import*as mXlsx from"wijmo/wijmo.xlsx";import*as selfModule from"wijmo/wijmo.grid.xlsx";export function softDetail(){return _getModule("wijmo.grid.detail")}export function softMultiRow(){return _getModule("wijmo.grid.multirow")}export function softTransposed(){return _getModule("wijmo.grid.transposed")}export function softTransposedMultiRow(){return _getModule("wijmo.grid.transposedmultirow")}var FlexGridXlsxConverter=function(){function FlexGridXlsxConverter(){}FlexGridXlsxConverter.save=function(e,t,l){var o=new mXlsx.Workbook;this._saveFlexGridToWorkbook(o,e,t,!1,null);l&&o.save(l);return o};FlexGridXlsxConverter.saveAsync=function(e,t,l,o,r,n,s){var i=this,a=new mXlsx.Workbook;if(!s){this._saveFlexGridToWorkbook(a,e,t,!1,null);l?a.saveAsync(l,(function(e){isFunction(o)&&o(e,a)}),r,null):isFunction(o)&&o(null,a);return a}var u=null!=l;this.cancelAsync((function(){var s,d=[e.collectionView&&e.collectionView.collectionChanged,e.columns&&e.columns.collectionChanged,e.rows&&e.rows.collectionChanged,e.resizedColumn,e.resizedRow],removeHandlers=function(){return d.forEach((function(e){e&&e.removeHandler(restart)}))},restart=function(){i._cs&&i._cs.cancel(!1);clearTimeout(s);s=setTimeout((function(){removeHandlers();a=null;i.saveAsync(e,t,l,o,r,n)}),100)},finish=function(){clearTimeout(s);i._cs=null;removeHandlers()};i._cs=new mXlsx._SyncPromise(null,finish);d.forEach((function(e){e&&e.addHandler(restart)}));i._saveFlexGridToWorkbook(a,e,t,!0,i._cs,(function(e){isFunction(n)&&n(u?Math.round(mXlsx._map(e,0,100,0,50)):e)})).then((function(){if(l){a._externalCancellation=function(){return i._cs};a.saveAsync(l,(function(e){finish();isFunction(o)&&o(e,a)}),(function(e){finish();isFunction(r)&&r(e)}),(function(e){isFunction(n)&&n(Math.round(mXlsx._map(e,0,100,51,100)))}))}else{finish();isFunction(n)&&n(100);isFunction(o)&&o(null,a)}}),(function(e){finish();throw e}))}));return null};FlexGridXlsxConverter.cancelAsync=function(e){var t=this;if(this._cs){this._cs.cancel();setTimeout((function(){t._cs=null;isFunction(e)&&e()}),100)}else isFunction(e)&&e()};FlexGridXlsxConverter.load=function(e,t,l){var o=this;if(t instanceof Blob)_blobToBuffer(t,(function(r){t=null;var n=new mXlsx.Workbook;n.load(r,l?l.includeStyles:void 0);r=null;e.deferUpdate((function(){o._loadToFlexGrid(e,n,l);n=null}))}));else if(t instanceof mXlsx.Workbook)e.deferUpdate((function(){o._loadToFlexGrid(e,t,l);t=null}));else{if(!(t instanceof ArrayBuffer||isString(t)))throw"Invalid workbook.";var r=new mXlsx.Workbook;r.load(t,l?l.includeStyles:void 0);t=null;e.deferUpdate((function(){o._loadToFlexGrid(e,r,l);r=null}))}};FlexGridXlsxConverter.loadAsync=function(e,t,l,o,r){var n=this;if(t instanceof Blob)_blobToBuffer(t,(function(s){t=null;var i=new mXlsx.Workbook;i.loadAsync(s,(function(){s=null;e.deferUpdate((function(){n._loadToFlexGrid(e,i,l);o&&o(i);i=null}))}),r,l?l.includeStyles:void 0)}));else if(t instanceof mXlsx.Workbook)e.deferUpdate((function(){n._loadToFlexGrid(e,t,l);o&&o(t);t=null}));else{if(!(t instanceof ArrayBuffer||isString(t)))throw"Invalid workbook.";var s=new mXlsx.Workbook;s.loadAsync(t,(function(){t=null;e.deferUpdate((function(){n._loadToFlexGrid(e,s,l);o&&o(s);s=null}))}),r,l?l.includeStyles:void 0)}};FlexGridXlsxConverter._saveFlexGridToWorkbook=function(e,t,l,o,r,n){var s=new mXlsx._SyncPromise(r),i=new mXlsx.WorkSheet,a=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,u=!(!l||null==l.includeRowHeaders)&&l.includeRowHeaders,d=_ExportCellStyles.Cache,c=l?l.includeColumns:null,f=l?l.formatItem:null,h=[],m=l&&null!=l.convertHtmlEntities?asEnum(l.convertHtmlEntities,HtmlEntityConversion):HtmlEntityConversion.Auto;if(l){null!=l.includeCellStyles&&_deprecated("includeCellStyles","includeStyles");d=!1===asBoolean(null!=l.includeStyles?l.includeStyles:l.includeCellStyles,!0)?_ExportCellStyles.None:!1===asBoolean(l.quickCellStyles,!0)?_ExportCellStyles.Regular:_ExportCellStyles.Cache}var p=d===_ExportCellStyles.Cache?new _StyleCache(500):null;null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style);i.name=l?l.sheetName:"";i.visible=!l||!1!==l.sheetVisible;i.rightToLeft=t.rightToLeft;var x,g=t.wj_sheetInfo;if(g&&g.tables&&g.tables.length>0)for(var v=0;v<g.tables.length;v++)i.tables.push(g.tables[v]);if(!g&&(d!==_ExportCellStyles.None||f)){(x=document.createElement("div")).style.visibility="hidden";x.setAttribute(FlexGrid._WJS_MEASURE,"true");t.hostElement.appendChild(x)}var w=u?t.rowHeaders.columns.length:0,C=this._getPerRowColumnsSettings(t,u?[t.topLeftCells,t.columnHeaders]:[t.columnHeaders]),y=C.cols,_=softMultiRow()&&t instanceof softMultiRow().MultiRow?this._getPerRowColumnsSettings(t,u?[t.rowHeaders,t.cells]:[t.cells],t.rowsPerItem).cols:null,b=y.length,S=[[t.topLeftCells,t.columnHeaders],[t.rowHeaders,t.cells],[t.bottomLeftCells,t.columnFooters]];a||S.shift();var T=S.map((function(e){return e[1].rows.length})).reduce((function(e,t){return e+t}));y.length&&y[0].forEach((function(e,t){var l=C.bndCols[0][t];if(!(t>=w&&c)||c(l)){var o=new mXlsx.WorkbookColumn;o._deserialize(e);i._addWorkbookColumn(o)}}));this._saveContentToWorksheet(r,o,Date.now(),0,{panels:S,panelIdx:0,globRowIdx:0,rowsOffset:0,totalRows:T},t,i,u,(function(e){return e==CellType.Cell&&_?_:y}),d,x,h,p,c,m,f,(function(e){n(Math.round(e/T*100))}),(function(){var o=new mXlsx.WorkbookFrozenPane;o.rows=a?t.frozenRows+b:t.frozenRows;o.columns=u?t.frozenColumns+w:t.frozenColumns;i.frozenPane=o;e._addWorkSheet(i);if(!g&&(d!==_ExportCellStyles.None||f)){t.hostElement.removeChild(x);h.forEach((function(e){return e.forEach((function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}))}))}p&&p.clear();e.activeWorksheet=l?l.activeWorksheet:null;s.resolve()}));return s};FlexGridXlsxConverter._saveContentToWorksheet=function(e,t,l,o,r,n,s,i,a,u,d,c,f,h,m,p,x,g){for(var v=this,w=u?20:200,_loop_1=function(y){if(e&&e.cancelled)return{value:void 0};if(t&&y-o>w&&Date.now()-l>100){setTimeout((function(){if(!e||!e.cancelled){x(y);v._saveContentToWorksheet(e,t,Date.now(),y,r,n,s,i,a,u,d,c,f,h,m,p,x,g)}}),0);return{value:void 0}}for(;y-r.rowsOffset>=r.panels[r.panelIdx][1].rows.length;){r.rowsOffset+=r.panels[r.panelIdx][1].rows.length;r.panelIdx++}var _=r.panels[r.panelIdx],b=_[0],S=_[1],T=y-r.rowsOffset,X=S.rows[T];if(S.cellType!==CellType.Cell&&X.renderSize<=0||X instanceof _NewRowTemplate)return"continue";var F=0,k={},R=new mXlsx.WorkbookRow,E=X instanceof GroupRow,G=0;S.cellType===CellType.Cell&&(E?G=X.level:n.rows.maxGroupLevel>-1&&(G=n.rows.maxGroupLevel+1));var W=a(S.cellType);i&&(F=C._parseFlexGridRowToSheetRow(s,b,k,T,0,W,u,d,c,f,E,G,h,m,p));C._parseFlexGridRowToSheetRow(s,S,k,T,F,W,u,d,c,f,E,G,h,m,p);if(k.cells.length>0){R._deserialize(k);s._addWorkbookRow(R,r.globRowIdx)}r.globRowIdx++},C=this,y=o;y<r.totalRows;y++){var _=_loop_1(y);if("object"==typeof _)return _.value}isFunction(g)&&g()};FlexGridXlsxConverter._loadToFlexGrid=function(e,t,l){if(softTransposedMultiRow()&&e instanceof softTransposedMultiRow().TransposedMultiRow)throw"Not supported.";l=l||{};var o,r=null!=e.wj_sheetInfo,n={},s=[],i=[],a={};e.itemsSource=null;e.columns.clear();e.columnHeaders.rows.clear();e.rows.clear();e.frozenColumns=0;e.frozenRows=0;var u=null==l.sheetIndex||isNaN(l.sheetIndex)?0:l.sheetIndex;if(u<0||u>=t.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=l.sheetName)for(var d=0;d<t.sheets.length;d++)if(l.sheetName===t.sheets[d].name){o=t.sheets[d];break}if(null!=(o=o||t.sheets[u]).rows){for(var c=this._getColumnCount(o.rows),f=this._getRowCount(o.rows,c),h=o.columns,m=0;m<c;m++){e.columns.push(new Column);if(h[m]){isNaN(+h[m].width)||(e.columns[m].width=+h[m].width);h[m].visible||null==h[m].visible||(e.columns[m].visible=!!h[m].visible);h[m].style&&h[m].style.wordWrap&&(e.columns[m].wordWrap=h[m].style.wordWrap)}}var p,x=(null==l.includeColumnHeaders||l.includeColumnHeaders)&&o.rows.length>0,g=x?this._getColumnHeadersHeight(o):0,v=!1,w=[],C=o.frozenPane&&o.frozenPane.rows,y=o.frozenPane&&o.frozenPane.columns;C=isNumber(C)&&!isNaN(C)?C:null;y=isNumber(y)&&!isNaN(y)?y:null;for(var _=g;_<f;_++){var b=!1,S=null,T=o.rows[_];if(T)for(var X=_+1;X<o.rows.length;){var F=o.rows[X];if(F){(isNaN(T.groupLevel)&&!isNaN(F.groupLevel)||!isNaN(T.groupLevel)&&T.groupLevel<F.groupLevel)&&(b=!0);break}X++}if(b&&!o.summaryBelow){p&&(p.isCollapsed=v);(p=new GroupRow).isReadOnly=!1;v=null!=T.collapsed&&T.collapsed;p.level=isNaN(T.groupLevel)?0:T.groupLevel;a[p.level]=v;this._checkParentCollapsed(a,p.level)&&p._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(p)}else{var k=new Row;T&&this._checkParentCollapsed(a,T.groupLevel)&&k._setFlag(RowColFlags.ParentCollapsed,!0);e.rows.push(k)}T&&T.height&&!isNaN(T.height)&&(e.rows[_-g].height=T.height);for(m=0;m<c;m++)if(T){var R=T.cells[m],E=R?R.formula:null;E&&"="!==E[0]&&(E="="+E);if(R&&R.textRuns&&R.textRuns.length>0){e.rows[_-g].isContentHtml=!0;e.setCellData(_-g,m,this._parseTextRunsToHTML(R.textRuns))}else e.setCellData(_-g,m,E&&r?E:this._getItemValue(R));b||this._setColumn(w,m,R);var G=_*c+m,W=R?R.style:null;if(W){S=null==S?!!W.wordWrap:S&&!!W.wordWrap;if(r){var A=mXlsx.Workbook._parseExcelFormat(R),N=void 0;if(W.hAlign)N=mXlsx.Workbook._parseHAlignToString(asEnum(W.hAlign,mXlsx.HAlign));else switch(this._getItemType(R)){case DataType.Number:N="right";break;case DataType.Boolean:N="center";break;default:N=A&&0===A.search(/[n,c,p]/i)?"right":"left"}n[G]={fontWeight:W.font&&W.font.bold?"bold":"none",fontStyle:W.font&&W.font.italic?"italic":"none",textDecoration:W.font&&W.font.underline?"underline":"none",textAlign:N,fontFamily:W.font&&W.font.family?W.font.family:"",fontSize:W.font&&W.font.size?W.font.size+"px":"",color:W.font&&W.font.color?W.font.color:"",backgroundColor:W.fill&&W.fill.color?W.fill.color:"",whiteSpace:W.wordWrap?"pre-wrap":"normal",format:A};if(W.borders){if(W.borders.left){this._parseBorderStyle(W.borders.left.style,"Left",n[G]);n[G].borderLeftColor=W.borders.left.color}if(W.borders.right){this._parseBorderStyle(W.borders.right.style,"Right",n[G]);n[G].borderRightColor=W.borders.right.color}if(W.borders.top){this._parseBorderStyle(W.borders.top.style,"Top",n[G]);n[G].borderTopColor=W.borders.top.color}if(W.borders.bottom){this._parseBorderStyle(W.borders.bottom.style,"Bottom",n[G]);n[G].borderBottomColor=W.borders.bottom.color}}if(W.fill&&W.fill.color){var H=n[G],B=W.borders,I=W.fill.color;if(B){B.left&&B.left.color||(H.borderLeftColor=I);B.right&&B.right.color||m===y-1||(H.borderRightColor=I);B.top&&B.top.color||(H.borderTopColor=I);B.bottom&&B.bottom.color||_===C-1||(H.borderBottomColor=I)}else{H.borderLeftColor=I;m!==y-1&&(H.borderRightColor=I);H.borderTopColor=I;_!==C-1&&(H.borderBottomColor=I)}}W.font&&-1===i.indexOf(W.font.family)&&i.push(W.font.family)}}r&&R&&isNumber(R.rowSpan)&&R.rowSpan>0&&isNumber(R.colSpan)&&R.colSpan>0&&(R.rowSpan>1||R.colSpan>1)&&s.push(new CellRange(_,m,_+R.rowSpan-1,m+R.colSpan-1))}if(T){this._checkParentCollapsed(a,T.groupLevel)||T.visible||null==T.visible||(e.rows[_-g].visible=T.visible);e.rows[_-g].wordWrap=!!T.style&&!!T.style.wordWrap||!!S}}p&&(p.isCollapsed=v);null!=y&&(e.frozenColumns=y);null!=C&&(e.frozenRows=x&&C>0?C-1:C);for(m=0;m<e.columnHeaders.columns.length;m++){var D=w[m],M=e.columns[m];M.isRequired=!1;if(D){D.dataType===DataType.Boolean&&(M.dataType=D.dataType);M.format=D.format;M.align=D.hAlign;M.wordWrap=M.wordWrap||!!D.wordWrap}}for(d=0;d<Math.max(g,1);d++)e.columnHeaders.rows.push(new Row);for(d=0;d<g;d++)for(var z=0;z<e.columnHeaders.columns.length;z++){var L=o.rows[d]?o.rows[d].cells[z]:null,O=L&&null!=L.value?L.value:"",j=e.columnHeaders.columns[z];if(O){var P=mXlsx.Workbook._parseExcelFormat(L);O=Globalize.format(O,P)}j.header=j.header||O;e.columnHeaders.setCellData(d,z,O)}if(r){var V=null==l.sheetVisible||l.sheetVisible;e.wj_sheetInfo.name=o.name;e.wj_sheetInfo.visible=!0===V||!1!==o.visible;e.wj_sheetInfo.styledCells=n;e.wj_sheetInfo.mergedRanges=s;e.wj_sheetInfo.fonts=i;e.wj_sheetInfo.tables=o.tables}}};FlexGridXlsxConverter._getColumnHeadersHeight=function(e){var t;if(!e||!(t=e.rows).length)return 0;if(!t[0])return 1;for(var l=0,o=1;l<t.length&&o>0;l++,o--){var r=t[l].cells.reduce((function(e,t){return Math.max(e,t.rowSpan||0)}),1);r>o&&(o=r)}return l};FlexGridXlsxConverter._escapePlainText=function(e){return null==e?"":""===e?"'":e&&("'"===e[0]||e.length>1&&"="===e[0]&&"="===e[1])?"'"+e:e};FlexGridXlsxConverter._parseFlexGridRowToSheetRow=function(e,t,l,o,r,n,s,i,a,u,d,c,f,h,m){var p=t.grid,x=p.wj_sheetInfo,g=t.rows[o],v=0,w=x&&x.evaluateFormula;null==g.recordIndex?t.cellType===CellType.ColumnHeader&&t.rows.length>1&&(v=Math.min(o,n.length-1)):v=g.recordIndex;l.cells||(l.cells=[]);l.visible=g.isVisible;l.height=g.renderHeight||t.rows.defaultSize;l.groupLevel=c;d&&(l.collapsed=g.isCollapsed);g.wordWrap&&(l.style={wordWrap:g.wordWrap});for(var C,y=g.constructor===Row||g.constructor===_NewRowTemplate||softTransposed()&&p instanceof softTransposed().TransposedGrid&&g instanceof Row||softDetail()&&g.constructor===softDetail().DetailRow||softMultiRow()&&g.constructor===softMultiRow()._MultiRow||softTransposedMultiRow()&&g instanceof softTransposedMultiRow()._MultiRow,_=softDetail()&&g.constructor===softDetail().DetailRow,b=0,S=Math.round(mXlsx._xlsx._parsePixelToCharWidth(p.treeIndent)||0),getTreeIndent=function(e){return e*S};b<t.columns.length;b++){var T=void 0,X=void 0,F=void 0,k=1,R=1,E=!1,G=p._getBindingColumn(t,o,t.columns[b]),W=0;if(x&&t===p.cells){var A=o*t.columns.length+b;x.mergedRanges&&(T=this._getMergedRange(o,b,x.mergedRanges));x.styledCells&&(X=x.styledCells[A])}else if(s!==_ExportCellStyles.None){F=this._getMeasureCell(t,b,i,a);X=(T=p.getMergedRange(t,o,b,!1))?this._getCellStyle(t,F,T.bottomRow,T.rightCol,u,!!m)||{}:this._getCellStyle(t,F,o,b,u,!!m)||{}}T||(T=p.getMergedRange(t,o,b,!1));if(T){if(o===T.topRow&&b===T.leftCol){R=T.bottomRow-T.topRow+1;k=this._getColSpan(t,T,f);E=!0}}else E=!0;if(!f||f(G)){var N=n[v]?n[v][b+r]:null,H=void 0,B=void 0,I=void 0,D=void 0,M=void 0,z=void 0,L=void 0;if(y||d){I=E?t.getCellData(o,b,!0):null;D=E?t.getCellData(o,b,!1):null;B=this._isFormula(I);H=null;M=isDate(D);if(X&&X.format){z=X.format;/[hsmyt\:]/i.test(z)&&(M=!0);L=mXlsx.Workbook._parseCellFormat(X.format,M)}else if(N&&N.style&&N.style.format){z=G.format;L=N.style.format}else L=null;B&&null!=w&&isFunction(w)&&(H=w(I));if(!L)if(M)L="m/d/yyyy";else if(isNumber(D)&&!G.dataMap)L=isInt(D)?"#,##0":"#,##0.00";else if(B){var O=I.toLowerCase();if(O.indexOf("now()")>-1){L="m/d/yyyy h:mm";M=!0}else if(O.indexOf("today()")>-1||O.indexOf("date(")>-1){L="m/d/yyyy";M=!0}else if(O.indexOf("time(")>-1){L="h:mm AM/PM";M=!0}}else L="General"}else{I=E?p.columnHeaders.getCellData(0,b,!0):null;L="General"}var j=void 0;if(isString(I)&&-1!==I.indexOf("<span")){j=this._parseToTextRuns(I);I=null}var P=this._parseCellStyle(X)||{};if(t===p.cells&&d&&g.hasChildren&&b===p.columns.firstVisibleIndex){var V=void 0;if(B&&null!=H)V=H;else{I?V=I:E&&(V=g.getGroupHeader());V&&(V=V.replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'"))}if(null==V&&!X)continue;!(M=isDate(V))&&z&&"d"===z.toLowerCase()&&isInt(V)&&(L="0");V=isString(V)?mXlsx.Workbook._unescapeXML(V):V;b===p.columns.firstVisibleIndex&&p.treeIndent&&(W=getTreeIndent(c));C={value:V,isDate:M,formula:B?this._parseToExcelFormula(I,M):null,colSpan:k,rowSpan:R,style:this._extend(P,{format:L,font:p.childItemsPath?{}:{bold:!0},hAlign:e.rightToLeft?mXlsx.HAlign.Right:mXlsx.HAlign.Left,indent:W}),textRuns:j}}else{if(d||h===HtmlEntityConversion.Auto&&G.isContentHtml||h===HtmlEntityConversion.Yes){I=isString(I)?mXlsx.Workbook._unescapeXML(I):I;D=isString(D)?mXlsx.Workbook._unescapeXML(D):D}!M&&z&&"d"===z.toLowerCase()&&isInt(D)&&(L="0");var U=void 0;U=P&&P.hAlign?P.hAlign:N&&N.style&&null!=N.style.hAlign?asEnum(N.style.hAlign,mXlsx.HAlign,!0):isDate(D)?mXlsx.HAlign.Left:mXlsx.HAlign.General;t===p.cells&&b===p.columns.firstVisibleIndex&&p.treeIndent&&(e.rightToLeft&&U===mXlsx.HAlign.Right||!e.rightToLeft&&U===mXlsx.HAlign.Left||U===mXlsx.HAlign.General)&&(W=getTreeIndent(c));C={value:B?H:"General"!==L||""===I&&null==D?this._escapePlainText(D):this._escapePlainText(I),isDate:M,formula:B?this._parseToExcelFormula(I,M):null,colSpan:b<p.columns.firstVisibleIndex?1:k,rowSpan:R,style:this._extend(P,{format:L,hAlign:U,vAlign:R>1?t===p.cells||!1===p.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:W}),textRuns:j}}if(m){m(new XlsxFormatItemEventArgs(t,new CellRange(o,b),F,i,a,u,C))}if(_){var Y=t.getCellElement(o,b);if(Y){var q=g.detail;Y.appendChild(q);Control.refreshAll(q)}}l.cells.push(C)}}return r+b};FlexGridXlsxConverter._parseCellStyle=function(e,t){void 0===t&&(t=!1);if(null==e)return null;var l=e.fontSize;l=l?+l.substring(0,l.indexOf("px")):null;isNaN(l)&&(l=null);var o=e.whiteSpace;o=!!o&&o.indexOf("pre")>-1;var r=e.textAlign;"start"===r&&(r="rtl"===e.direction?"right":"left");"end"===r&&(r="rtl"===e.direction?"left":"right");return{font:{bold:"bold"===e.fontWeight||+e.fontWeight>=700,italic:"italic"===e.fontStyle,underline:"underline"===(e.textDecorationStyle||e.textDecoration),family:this._parseToExcelFontFamily(e.fontFamily),size:l,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,t),hAlign:mXlsx.Workbook._parseStringToHAlign(r),wordWrap:o}};FlexGridXlsxConverter._parseBorder=function(e,t){var l={left:this._parseEgdeBorder(e,"Left"),right:this._parseEgdeBorder(e,"Right"),top:this._parseEgdeBorder(e,"Top"),bottom:this._parseEgdeBorder(e,"Bottom")};if(t){l.vertical=this._parseEgdeBorder(e,"Vertical");l.horizontal=this._parseEgdeBorder(e,"Horizontal")}return l};FlexGridXlsxConverter._parseEgdeBorder=function(e,t){var l,o=e["border"+t+"Style"],r=e["border"+t+"Width"];r&&(r=parseFloat(r));if(o&&"none"!==o&&"hidden"!==o&&0!==r){l={};switch(o=o.toLowerCase()){case"dotted":l.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":l.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":l.style=mXlsx.BorderStyle.Double;break;default:l.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}l.color=e["border"+t+"Color"]}return l};FlexGridXlsxConverter._parseBorderStyle=function(e,t,l){var o="border"+t+"Style",r="border"+t+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:l[o]="dotted";l[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:l[o]="dashed";l[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:l[o]="dashed";l[r]="2px";break;case mXlsx.BorderStyle.Double:l[o]="double";l[r]="3px";break;case mXlsx.BorderStyle.Medium:l[o]="solid";l[r]="2px";break;case mXlsx.BorderStyle.Thick:l[o]="solid";l[r]="3px";break;default:l[o]="solid";l[r]="1px"}};FlexGridXlsxConverter._parseToExcelFontFamily=function(e){var t;e&&(t=e.split(","))&&t.length>0&&(e=t[0].replace(/\"|\'/g,""));return e};FlexGridXlsxConverter._parseToExcelFormula=function(e,t){var l=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi);if(l)for(var o=0;o<l.length;o++){var r=(s=l[o]).substring(0,s.lastIndexOf(")"))+", 1)";e=e.replace(s,r)}l=null;if(l=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi)){var n=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;for(o=0;o<l.length;o++){var s,i=(s=l[o]).match(n);if(i&&2===i.length){var a=i[1];if(!/^d{1,4}?$/.test(a)){var u=mXlsx.Workbook._parseCellFormat(a,t);r=s.replace(a,u);e=e.replace(s,r)}}}}return e};FlexGridXlsxConverter._parseToTextRuns=function(e){for(var t=e.split("<span "),l=[],o=0;o<t.length;o++){var r=t[o],n=void 0;if(-1!==r.indexOf("</span>")){n={text:r.substring(r.indexOf(">")+1,r.indexOf("</span>")),font:this._parseToTextRunFont(r.substring(r.indexOf('style="')+7,r.indexOf(';"')))}}else n={text:r};l.push(n)}return l};FlexGridXlsxConverter._parseToTextRunFont=function(e){var t,l=e.split(";");if(l.length>0){for(var o=void 0,r=void 0,n=void 0,s=void 0,i=void 0,a=void 0,u=0;u<l.length;u++){var d=l[u].split(":");if(2===d.length){d[1]=d[1].trim();switch(d[0]){case"font-size":s=+d[1].substring(0,d[1].indexOf("px"));isNaN(s)&&(s=null);break;case"font-weight":o="bold"===d[1]||+d[1]>=700;break;case"font-style":r="italic"===d[1];break;case"text-decoration-style":case"text-decoration":n="underline"===d[1];break;case"font-family":i=this._parseToExcelFontFamily(d[1]);break;case"color":a=d[1]}}}t={bold:o,italic:r,underline:n,family:i,size:s,color:a}}return t};FlexGridXlsxConverter._getMeasureCell=function(e,t,l,o){var r=o[e.cellType],n=r&&r[t],s=null==n;if(n){if(this.hasCssText){n.style.cssText="";n.style.visibility="hidden"}}else{r||(o[e.cellType]=r=[]);r[t]=n=l.cloneNode()}!s&&n.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(n):e.hostElement.appendChild(n));return n};FlexGridXlsxConverter._getColumnSetting=function(e,t,l){var o=e;null!=e.colspan&&(o=this._getRenderColumn(t,l));return o?{autoWidth:!0,width:o.renderWidth||l.defaultSize,visible:o.visible&&0!==o.width&&!o._getFlag(RowColFlags.ParentCollapsed),style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(o.getAlignment())),wordWrap:o.wordWrap}}:null};FlexGridXlsxConverter._getPerRowColumnsSettings=function(e,t,l){var o=this,r=[],n=[];t.forEach((function(s,i){for(var a=0,u=i>0?t[0].columns.length:0,_loop_2=function(t){if(null!=l&&t>=l)return"break";if(s.rows[t].renderSize<=0)return"continue";r[a]=r[a]||[];n[a]=n[a]||[];s.columns.forEach((function(l,i){var d=e._getBindingColumn(s,t,l),c=o._getColumnSetting(d,i,s.columns);if(c){r[a][u+i]=c;n[a][u+i]=d}}));a++},d=0;d<s.rows.length;d++){if("break"===_loop_2(d))break}}));return{cols:r,bndCols:n}};FlexGridXlsxConverter._toExcelHAlign=function(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e};FlexGridXlsxConverter._getColumnCount=function(e){for(var t=0,l=0;l<e.length;l++){var o=e[l]&&e[l].cells?e[l].cells:[];if(o&&o.length>0){var r=o.length;isInt(o[r-1].colSpan)&&o[r-1].colSpan>1&&(r=r+o[r-1].colSpan-1);r>t&&(t=r)}}return t};FlexGridXlsxConverter._getRowCount=function(e,t){for(var l=e.length,o=l-1,r=0;r<t;r++)e:for(;o>=0;o--){var n=e[o],s=(n&&n.cells?n.cells:[])[r];if(s&&(null!=s.value&&""!==s.value||isInt(s.rowSpan)&&s.rowSpan>1)){isInt(s.rowSpan)&&s.rowSpan>1&&o+s.rowSpan>l&&(l=o+s.rowSpan);break e}}return l};FlexGridXlsxConverter._numAlpha=function(e){var t=Math.floor(e/26)-1;return(t>-1?this._numAlpha(t):"")+String.fromCharCode(65+e%26)};FlexGridXlsxConverter._getItemType=function(e){return null==e||null==e.value||isNaN(e.value)?null:getType(e.value)};FlexGridXlsxConverter._setColumn=function(e,t,l){var o=e[t];if(o){var r=this._getItemType(l);o.dataType!==r&&o.dataType===DataType.Boolean&&r!==DataType.Boolean&&(o.dataType=r);if(l&&null!=l.value&&(!isString(l.value)||!isNullOrWhiteSpace(l.value))){var n=mXlsx.Workbook._parseExcelFormat(l);n&&o.format!==n&&"General"!==n&&(o.format=n)}var s=void 0;if(l&&l.style){l.style.hAlign&&(s=mXlsx.Workbook._parseHAlignToString(asEnum(l.style.hAlign,mXlsx.HAlign)));null==o.wordWrap?o.wordWrap=!!l.style.wordWrap:o.wordWrap=o.wordWrap&&!!l.style.wordWrap}s||r!==DataType.Number||(s="right");o.hAlign=s}else e[t]={dataType:this._getItemType(l),format:mXlsx.Workbook._parseExcelFormat(l),hAlign:"",wordWrap:null}};FlexGridXlsxConverter._getItemValue=function(e){if(null==e||null==e.value)return null;var t=e.value;isString(t)&&"'"===t[0]&&(t=t.substr(1));return isNumber(t)&&isNaN(t)?"":t instanceof Date&&isNaN(t.getTime())?"":t};FlexGridXlsxConverter._getCellStyle=function(e,t,l,o,r,n){var s,i=e.grid;try{var a=!(r&&!i.formatItem.hasHandlers&&!i.itemFormatter&&!n);i.cellFactory.updateCell(e,l,o,t,null,a);t.className=t.className.replace("wj-state-selected","");t.className=t.className.replace("wj-state-multi-selected","")}catch(e){return null}if(r){var u=e.hostElement,d=t,c=d.style.cssText.split(/;\s+/).filter((function(e){var t=e.substring(0,e.indexOf(":"));return/^(color|background|border|font|text|whitespace)/i.test(t)})).join(";");do{c=d.className+c}while(d!==u&&(d=d.parentElement));if(!(s=r.getValue(c))){s=window.getComputedStyle(t);r.add(c,s)}}else s=window.getComputedStyle(t);return s};FlexGridXlsxConverter._parseTextRunsToHTML=function(e){for(var t="",l=0;l<e.length;l++){var o=e[l],r=o.font;t+=r?'<span style="'+(r.bold?"font-weight: bold;":"")+(r.italic?"font-style: italic;":"")+(r.underline?"text-decoration: underline;":"")+(r.family?"font-family: "+r.family+";":"")+(null!=r.size?"font-size: "+r.size+"px;":"")+(r.color?"color: "+r.color+";":"")+'">'+o.text+"</span>":o.text}return t};FlexGridXlsxConverter._extend=function(e,t){for(var l in t){var o=t[l];isObject(o)&&e[l]?copy(e[l],o):e[l]=o}return e};FlexGridXlsxConverter._checkParentCollapsed=function(e,t){var l=!1;Object.keys(e).forEach((function(o){!0===e[o]&&!1===l&&!isNaN(t)&&+o<t&&(l=!0)}));return l};FlexGridXlsxConverter._getColSpan=function(e,t,l){for(var o=0,r=t.leftCol;r<=t.rightCol;r++)l&&!l(e.columns[r])||o++;return o};FlexGridXlsxConverter._getRenderColumn=function(e,t){return e>=t.length?null:t[e]};FlexGridXlsxConverter._getMergedRange=function(e,t,l){for(var o=0;o<l.length;o++){var r=l[o];if(e>=r.topRow&&e<=r.bottomRow&&t>=r.leftCol&&t<=r.rightCol)return r}return null};FlexGridXlsxConverter._isFormula=function(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]};return FlexGridXlsxConverter}();export{FlexGridXlsxConverter};var _ExportCellStyles,XlsxFormatItemEventArgs=function(e){__extends(XlsxFormatItemEventArgs,e);function XlsxFormatItemEventArgs(t,l,o,r,n,s,i){var a=e.call(this,t,l)||this;a._cell=o;a._patternCell=r;a._xlsxCell=i;a._cellsCache=n;a._styleCache=s;return a}Object.defineProperty(XlsxFormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});Object.defineProperty(XlsxFormatItemEventArgs.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(e){this._xlsxCell=e},enumerable:!0,configurable:!0});XlsxFormatItemEventArgs.prototype.getFormattedCell=function(){if(!this._cell){this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache);FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col,this._styleCache,!0)}return this._cell};return XlsxFormatItemEventArgs}(CellRangeEventArgs);export{XlsxFormatItemEventArgs};!function(e){e[e.None=0]="None";e[e.Regular=1]="Regular";e[e.Cache=2]="Cache"}(_ExportCellStyles||(_ExportCellStyles={}));var _StyleCache=function(){function _StyleCache(e){this._cache={};this._size=0;this._max=e}_StyleCache.prototype.add=function(e,t){this._size>=this._max&&this.clear();this._cache[e]=this._cloneStyle(t);this._size++};_StyleCache.prototype.clear=function(){this._cache={};this._size=0};_StyleCache.prototype.getValue=function(e){return this._cache[e]||null};_StyleCache.prototype.hasKey=function(e){return!!this._cache[e]};_StyleCache.prototype._cloneStyle=function(e){if(!e)return null;for(var t={},toCamel=function(e){return e.replace(/\-([a-z])/g,(function(e,t,l){return l>0?t.toUpperCase():t}))},l=0,o=e.length;l<o;l++){var r=e[l];t[toCamel(r)]=e.getPropertyValue(r)}return t};return _StyleCache}();export{_StyleCache};export function _blobToBuffer(e,t){if(e&&t)if(e.arrayBuffer)e.arrayBuffer().then((function(e){return t(e)}));else{var l=new FileReader;l.onload=function(){t(l.result);l=null};l.readAsArrayBuffer(e)}}export var HtmlEntityConversion;!function(e){e[e.Auto=0]="Auto";e[e.No=1]="No";e[e.Yes=2]="Yes"}(HtmlEntityConversion||(HtmlEntityConversion={}));_registerModule("wijmo.grid.xlsx",selfModule);